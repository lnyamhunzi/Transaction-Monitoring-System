{% extends "base.html" %}

{% block title %}Add New Sanctions List Entry{% endblock %}

{% block page_title %}Add New Sanctions List Entry{% endblock %}

{% block content %}
<div class="card">
    <div class="card-body">
        <h5 class="card-title">New Sanctions List Entry</h5>
        <form id="addSanctionsListForm">
            <div class="mb-3">
                <label for="listName" class="form-label">List Name</label>
                <input type="text" class="form-control" id="listName" name="list_name" required>
            </div>
            <div class="mb-3">
                <label for="entityName" class="form-label">Entity Name</label>
                <input type="text" class="form-control" id="entityName" name="entity_name" required>
            </div>
            <div class="mb-3">
                <label for="entityType" class="form-label">Entity Type</label>
                <input type="text" class="form-control" id="entityType" name="entity_type">
            </div>
            <div class="mb-3">
                <label for="nationality" class="form-label">Nationality</label>
                <input type="text" class="form-control" id="nationality" name="nationality">
            </div>
            <div class="mb-3">
                <label for="program" class="form-label">Program</label>
                <input type="text" class="form-control" id="program" name="program">
            </div>
            <div class="mb-3">
                <label for="remarks" class="form-label">Remarks</label>
                <textarea class="form-control" id="remarks" name="remarks" rows="3"></textarea>
            </div>
            <button type="submit" class="btn btn-primary">Add Entry</button>
            <a href="/sanctions/lists" class="btn btn-secondary">Cancel</a>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.getElementById('addSanctionsListForm');
        form.addEventListener('submit', async function(event) {
            event.preventDefault();

            const formData = new FormData(form);
            const data = {};
            formData.forEach((value, key) => (data[key] = value));

            try {
                const response = await fetch('/api/sanctions/lists/add', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('admin_token')}`
                    },
                    body: JSON.stringify(data)
                });

                if (response.ok) {
                    alert('Sanctions list entry added successfully!');
                    window.location.href = '/sanctions/lists';
                } else {
                    const errorData = await response.json();
                    alert(`Error: ${errorData.detail || response.statusText}`);
                }
            } catch (error) {
                console.error('Error adding sanctions list entry:', error);
                alert('An error occurred while adding the entry.');
            }
        });
    });
</script>
{% endblock %}