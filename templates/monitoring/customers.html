{% extends "base.html" %}

{% block title %}Customer Monitoring{% endblock %}

{% block page_title %}Customer Monitoring{% endblock %}

{% block content %}
<div class="card">
    <div class="card-body">
        <h5 class="card-title">Customer Search and Risk Profiling</h5>
        <div class="row mb-3">
            <div class="col-md-6">
                <input type="text" class="form-control" id="customerSearchInput" placeholder="Search by customer name or ID">
            </div>
            <div class="col-md-3">
                <select class="form-select" id="customerRiskRatingFilter">
                    <option value="all">All Risk Ratings</option>
                    <option value="LOW">Low</option>
                    <option value="MEDIUM">Medium</option>
                    <option value="HIGH">High</option>
                    <option value="CRITICAL">Critical</option>
                </select>
            </div>
            <div class="col-md-3">
                <button class="btn btn-primary w-100" id="applyCustomerFiltersBtn">Search</button>
            </div>
        </div>
        <table class="table table-striped" id="customersMonitoringTable">
            <thead>
                <tr>
                    <th>Customer ID</th>
                    <th>Customer Name</th>
                    <th>Risk Rating</th>
                    <th>Last Login</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for c in customers %}
                <tr>
                    <td>{{ c.customer_id }}</td>
                    <td>{{ c.full_name }}</td>
                    <td><span class="badge bg-{{ c.risk_rating.value.lower() }}">{{ c.risk_rating.value }}</span></td>
                    <td>{{ c.last_login.strftime('%Y-%m-%d %H:%M:%S') if c.last_login else 'N/A' }}</td>
                    <td><a href="/customers/{{ c.customer_id }}/profile" class="btn btn-sm btn-outline-primary">View Profile</a></td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
$(document).ready(function() {
    $('#customersMonitoringTable').DataTable();
});
</script>
{% endblock %}